{% extends "base.html" %}

{% block title %}設定編集 - 不動産事業計画{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1>設定編集</h1>
        <p>YAML設定ファイルのパラメータをWebから編集できます。</p>
    </div>
</div>

<form method="POST" class="config-form">
    <div class="form-section">
        <h5>基本情報</h5>
        <div class="row">
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="elapsed_years" class="form-label">経過年数</label>
                    <input type="number" class="form-control" id="elapsed_years" name="elapsed_years" 
                           value="{{ config.get('elapsed_years', 15) }}" min="0" max="50">
                </div>
            </div>
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="purchase_price" class="form-label">購入価格</label>
                    <input type="text" class="form-control" id="purchase_price" name="purchase_price" 
                           value="{{ config.get('purchase_price', '420,000,000') }}"
                           placeholder="例: 420,000,000">
                </div>
            </div>
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="initial_capital_ratio" class="form-label">自己資金比率</label>
                    <input type="number" class="form-control" id="initial_capital_ratio" name="initial_capital_ratio" 
                           value="{{ config.get('initial_capital_ratio', 0.25) }}" 
                           min="0" max="1" step="0.01">
                </div>
            </div>
        </div>
    </div>

    <div class="form-section">
        <h5>ローン条件</h5>
        <div class="row">
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="loan_annual_rate" class="form-label">年利</label>
                    <input type="number" class="form-control" id="loan_annual_rate" name="loan_annual_rate" 
                           value="{{ config.get('loan', {}).get('annual_rate', 0.035) }}" 
                           min="0" max="0.2" step="0.001">
                </div>
            </div>
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="loan_years" class="form-label">返済年数</label>
                    <input type="number" class="form-control" id="loan_years" name="loan_years" 
                           value="{{ config.get('loan', {}).get('years', 35) }}" 
                           min="1" max="50">
                </div>
            </div>
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="loan_start_month" class="form-label">開始月</label>
                    <input type="number" class="form-control" id="loan_start_month" name="loan_start_month" 
                           value="{{ config.get('loan', {}).get('start_month', 4) }}" 
                           min="1" max="12">
                </div>
            </div>
        </div>
    </div>

    <div class="form-section">
        <h5>建物情報</h5>
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="building_cost" class="form-label">建物価格</label>
                    <input type="text" class="form-control" id="building_cost" name="building_cost" 
                           value="{{ config.get('building', {}).get('cost', '35,654,400') }}"
                           placeholder="例: 35,654,400">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="building_statutory_life" class="form-label">法定耐用年数</label>
                    <input type="number" class="form-control" id="building_statutory_life" name="building_statutory_life" 
                           value="{{ config.get('building', {}).get('statutory_life', 34) }}" 
                           min="1" max="100">
                </div>
            </div>
        </div>
    </div>

    <div class="form-section">
        <h5>設備情報</h5>
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="equipment_cost" class="form-label">設備価格</label>
                    <input type="text" class="form-control" id="equipment_cost" name="equipment_cost" 
                           value="{{ config.get('equipment', {}).get('cost', '0') }}"
                           placeholder="例: 0 (0の場合は建物価格の15%で自動計算)">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="equipment_statutory_life" class="form-label">法定耐用年数</label>
                    <input type="number" class="form-control" id="equipment_statutory_life" name="equipment_statutory_life" 
                           value="{{ config.get('equipment', {}).get('statutory_life', 15) }}" 
                           min="1" max="100">
                </div>
            </div>
        </div>
    </div>

    <div class="form-section">
        <h5>税金情報</h5>
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="tax_land_assessed_value" class="form-label">土地評価額</label>
                    <input type="text" class="form-control" id="tax_land_assessed_value" name="tax_land_assessed_value" 
                           value="{{ config.get('tax', {}).get('land_assessed_value', '88,559,000') }}"
                           placeholder="例: 88,559,000">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="tax_building_assessed_value" class="form-label">建物評価額</label>
                    <input type="text" class="form-control" id="tax_building_assessed_value" name="tax_building_assessed_value" 
                           value="{{ config.get('tax', {}).get('building_assessed_value', '35,654,400') }}"
                           placeholder="例: 35,654,400">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="tax_land_area_m2" class="form-label">土地面積 (m²)</label>
                    <input type="number" class="form-control" id="tax_land_area_m2" name="tax_land_area_m2" 
                           value="{{ config.get('tax', {}).get('land_area_m2', 273.76) }}" 
                           min="0" step="0.01">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="tax_units" class="form-label">戸数</label>
                    <input type="number" class="form-control" id="tax_units" name="tax_units" 
                           value="{{ config.get('tax', {}).get('units', 12) }}" 
                           min="1">
                </div>
            </div>
        </div>
    </div>

    <div class="form-section">
        <h5>収入情報</h5>
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="income_monthly_rent" class="form-label">1戸あたり月額賃料</label>
                    <input type="text" class="form-control" id="income_monthly_rent" name="income_monthly_rent"
                           value="{{ config.get('income', {}).get('monthly_rent', '') }}"
                           placeholder="例: 85000 または 85,000">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="income_units" class="form-label">戸数</label>
                    <input type="number" class="form-control" id="income_units" name="income_units"
                           value="{{ config.get('income', {}).get('units', 12) }}" min="1">
                </div>
            </div>
        </div>
    </div>

    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">キャンセル</a>
        <button type="submit" class="btn btn-primary">設定を保存</button>
    </div>
</form>

<div class="mt-4">
    <h4>設定ファイル (project_config.yml)</h4>
    <pre class="bg-light p-3"><code>{{ config | tojson(indent=2) }}</code></pre>
</div>
{% endblock %}
